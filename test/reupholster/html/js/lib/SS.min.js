(function(e,h){var d=document.location;function c(i){if(typeof i==="string"){return}for(var j in i){c(i[j]);if(j.indexOf(":")!==-1){var k=j.replace(/:.*?\/|:.*?$/g,"([a-zA-Z0-9-]+)/").slice(0,-1);i[k]=i[j];delete i[j]}}}e.Router=b;function b(i){if(!(this instanceof b)){return new b(i)}var k=this;this.routes=i;var m;this.recurse=function(o){if(o===h){return recurse}m=(this._recurse=o)==="forward"?"unshift":"push"};this._recurse=null;this.recurse(null);this.resource=null;this.state={};this.after=[];this.on=[];this.once=[];this.oneach=[];this.aftereach=[];this.notfound=null;this.lastroutevalue=null;this.alreadyrun=false;c(this.routes);function l(t){for(var p=0,o=k[t].length;p<o;p++){var q=k[t][p];var r=q.val===null?k.lastroutevalue:q.val;if(typeof q.fn==="string"){q.fn=k.resource[q.fn]}if(typeof r==="string"){r=[r]}if(q.fn.apply(k.resource||null,r||[])===false){k[t]=[];return false}if(q.val!==null){k.lastroutevalue=q.val}}}function n(C,D,x,q){var u,y;var B=C[D];if(!B||D==="/"){for(var p in C){if(C.hasOwnProperty(p)){y=D.match(new RegExp("^"+p));u=D.match(new RegExp("^"+p+"(.*)?"));if(y&&u){for(var v=u.length;v>=0;v--){if(u[v]){u[v]=u[v].replace(/^\//,"")}else{u.splice(v,1)}}if(y[0]==="/"&&u.length>1&&"/([a-zA-Z0-9-]+)" in C){continue}var t=y[0].split("/").length-1,z=u.slice(y.length),A=x-t,o=q.concat(y.slice(1));if(y.length>1){B=C[p]}else{B=C[y[0]]}if(w(z,A,o)){return true}}}}}else{A=x-D.split("/").length+1}w("/",A,q);function w(G,F,E){if(B){if(typeof G!=="string"){G="/"+G.join("/")}if(G!=="/"){n(B,G,F,E)}if(F===0||k._recurse){function r(K,J){if(K&&typeof K!=="string"&&K[0]){for(var I=0,H=K.length;I<H;I++){k[J][m]({fn:K[I],val:E||G})}}else{k[J][m]({fn:K,val:E||G})}}if(typeof B==="function"||B.on){r(B.on||B,"on")}if(B.once&&!B.once._fired){B.once._fired=true;r(B.once,"once")}if(B.after){r(B.after,"after")}return true}}else{k.noroute(E)}}return true}function j(p){var q=d.hash.slice(1);var o=q.split("/").length-1;k.after=[];if(n(k.routes,q,o,[])){l("on");l("once");l("oneach");k.on=[];k.once=[]}l("after");l("aftereach")}this.init=function(o){if(d.hash===""&&o){d.hash=o}if(d.hash.length>0){j()}f.init(j);return this};this.destroy=function(){f.destroy(j);return this};return this}b.prototype.use=function(m){for(var q in m){if(m.hasOwnProperty(q)){if(q==="recurse"){this.recurse(m[q]);continue}if(q==="resource"){this.resource=m[q];continue}if(q==="notfound"){this.notfound=m[q];continue}var p=m[q];var k=null;var o=({}).toString.call(p);if(q==="on"){k="oneach"}if(q==="after"){k="aftereach"}if(o.indexOf("Array")!==-1){for(var n=0,j=p.length;n<j;n++){this[k].push({fn:p[n],val:null})}}else{this[k].push({fn:p,val:null})}}}return this};b.prototype.noroute=function(k){if(this.notfound){if(({}).toString.call(this.notfound).indexOf("Array")!==-1){for(var m=0,j=this.notfound.length;m<j;m++){this.notfound[m](k)}}else{this.notfound(k)}}};b.prototype.explode=function(){var i=d.hash;if(i[1]==="/"){i=i.slice(1)}return i.slice(1,i.length).split("/")};b.prototype.setRoute=function(l,j,m){var k=this.explode();if(typeof l==="number"&&typeof j==="string"){k[l]=j}else{if(typeof m==="string"){k.splice(l,j,s)}else{k=[l]}}f.setHash(k.join("/"));return k};b.prototype.getState=function(){return this.state};b.prototype.getRoute=function(i){var j=i;if(typeof i==="number"){j=this.explode()[i]}else{if(typeof i==="string"){var k=this.explode();j=k.indexOf(i)}else{j=this.explode()}}return j};var a="0.4.0",g="modern",f={hash:d.hash,check:function(){var i=d.hash;if(i!=this.hash){this.hash=i;this.onHashChanged()}},fire:function(){if(g==="modern"){e.onhashchange()}else{this.onHashChanged()}},init:function(k){var i=this;if(!e.Router.listeners){e.Router.listeners=[]}function j(){for(var n=0,m=e.Router.listeners.length;n<m;n++){e.Router.listeners[n]()}}if("onhashchange" in e&&(document.documentMode===h||document.documentMode>7)){e.onhashchange=j;g="modern"}else{var l=document.createElement("iframe");l.id="state-frame";l.style.display="none";document.body.appendChild(l);this.writeFrame("");if("onpropertychange" in document&&"attachEvent" in document){document.attachEvent("onpropertychange",function(){if(event.propertyName==="location"){i.check()}})}e.setInterval(function(){i.check()},50);this.onHashChanged=j;g="legacy"}e.Router.listeners.push(k);return g},destroy:function(l){if(!e.Router||!e.Router.listeners){return}var k=e.Router.listeners;for(var j=k.length-1;j>=0;j--){if(k[j]===l){k.splice(j,1)}}},setHash:function(i){if(g==="legacy"){this.writeFrame(i)}d.hash=(i[0]==="/")?i:"/"+i;return this},writeFrame:function(i){var j=document.getElementById("state-frame");var k=j.contentDocument||j.contentWindow.document;k.open();k.write("<script>_hash = '"+i+"'; onload = parent.listener.syncHash;<script>");k.close()},syncHash:function(){var i=this._hash;if(i!=d.hash){d.hash=i}return this},onHashChanged:function(){}}}(window));